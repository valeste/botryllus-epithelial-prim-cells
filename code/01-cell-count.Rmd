---
title: "01-cell-counts"
output: html_document
date: "2025-11-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
```


# Read in data


```{r, engine='bash', eval=FALSE}
cd ..

curl -L https://docs.google.com/spreadsheets/d/1h0eBKz5aceI5-401Zr3X7JUlfH7e1a3XABSWambZ-Ac/export?exportFormat=csv | tee data/cell_count_tissue_type.csv
```

# Mock dataset
```{r}
cell_counts <- read.csv("../data/cell_count_tissue_type.csv")
```




```{r}
genet_means <- cell_counts %>%
  group_by(genet, tissue) %>%
  summarise(
    sd_cell_count = sd(cell_count, na.rm = TRUE),
    mean_cell_count = mean(cell_count, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  )

# if you want summary stats at well level. Depends on what we are calling a technical replicate. I think that tisuse is a tech rep. we have a total of 15 tissue pieces that are either of zooid or bud from the same genet disperesed across three wells (5 tissue piece groups for a total of 10 tissue pieces per well)
genet_means2 <- cell_counts %>%
  group_by(genet, tissue, well) %>%
  summarise(
    mean_cell_count = mean(cell_count, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  group_by(genet, tissue) %>%
  summarise(
    mean_cell_count1 = mean(mean_cell_count),
    sd_cell_count   = sd(mean_cell_count),
    n               = n(),  # number of wells
    .groups = "drop"
  )


genet_means
genet_means2
```



```{r}
summary_tissue <- genet_means %>%
  group_by(tissue) %>%
  summarise(
    sd_cell_count   = sd(mean_cell_count, na.rm = TRUE),
    mean_cell_count = mean(mean_cell_count, na.rm = TRUE),
    n               = n(),
    .groups = "drop"
  )

summary_tissue
```
Setting color manually for each geneotype (genet) and renaming the individuals from mtt1 -> tunciate 1 
```{r}
genet_colors <- c(
  "mtt1" = "#1B9E77",
  "mtt2" = "#D95F02",
  "mtt3" = "#7570B3"
)

scale_color_manual(
  values = genet_colors,
  labels = c(
    "mtt1" = "Tunicate 1",
    "mtt2" = "Tunicate 2",
    "mtt3" = "Tunicate 3"
  ),
  drop = FALSE
)

```


```{r}
setwd('..')
png(filename = "output/cell_count.png", width = 1200, height = 900)
ggplot(genet_means,
       aes(x = tissue, y = mean_cell_count, fill = tissue)) +
  stat_summary(
    fun = mean,
    geom = "bar",
    width = 0.65,
    color = "white"
  ) +
  stat_summary(
    fun.data = mean_sdl,
    fun.args = list(mult = 1),   # ±1 SD across genets
    geom = "errorbar",
    width = 0.2
  ) +
  geom_jitter(
    aes(color = genet),
    width = 0.1,
    size = 5,
    alpha = 0.8
  ) +
  annotate(
    "text",
    x = 1.5,  # midpoint between bud and zooid
    y = max(genet_means$mean_cell_count) * 1.08,
    label = "ns",
    size = 10
  ) +
  scale_fill_manual(
    values = c("zooid" = "mistyrose4",
               "bud"   = "mistyrose3")
  ) +
   scale_color_manual(
    values = genet_colors,
    labels = c(
      "mtt1" = "Tunicate 1",
      "mtt2" = "Tunicate 2",
      "mtt3" = "Tunicate 3"
    ),
    drop = FALSE
  ) +
  labs(
    x = "Seeded tissue type",
    y = "Mean cell count",
    color = "Genet"
  ) +
  guides(
    fill = "none"   # removes tissue legend
  ) +
  theme_classic() +
  theme(
    text = element_text(family = "sans"),
    axis.title.x = element_text(size = 33),
    axis.title.y = element_text(size = 33),
    axis.text.x  = element_text(size = 30),
    axis.text.y  = element_text(size = 30),

    # ⬇️ legend sizing
    legend.title = element_text(size = 28),
    legend.text  = element_text(size = 24),
    legend.key.size = unit(1.5, "cm")
  )

dev.off()
```


# stats
```{r}
library(tidyr)

genet_wide <- genet_means %>%
  select(genet, tissue, mean_cell_count) %>%
  pivot_wider(
    names_from  = tissue,
    values_from = mean_cell_count
  )

#parametric assement
t.test(genet_wide$bud, genet_wide$zooid, paired = TRUE)

#non-parametric assessment
wilcox.test(genet_wide$bud, genet_wide$zooid, paired = TRUE)

```


