---
title: "01-cell-counts"
output: html_document
date: "2025-11-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
```


# Read in data


```{r, engine='bash', eval=FALSE}
cd ..

curl -L https://docs.google.com/spreadsheets/d/1h0eBKz5aceI5-401Zr3X7JUlfH7e1a3XABSWambZ-Ac/export?exportFormat=csv | tee data/cell_count_tissue_type.csv
```

# Mock dataset
```{r}
cell_counts <- read.csv("../data/cell_count_tissue_type.csv")
```

```{r}
mean_of_techs <-cell_counts %>%
  group_by(tissue) %>%
  summarise(
    mean_cell_count = mean(cell_count, na.rm = TRUE),
    sd_cell_count   = sd(cell_count, na.rm = TRUE),
    n               = n(),
    se_cell_count   = sd_cell_count / sqrt(n),
    .groups = "drop"
  )


```



```{r}
genet_means <- cell_counts %>%
  group_by(genet, tissue) %>%
  summarise(
    sd_cell_count = sd(cell_count, na.rm = TRUE),
    mean_cell_count = mean(cell_count, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  )

genet_means
```

```{r}
summary_tissue <- genet_means %>%
  group_by(tissue) %>%
  summarise(
    sd_cell_count   = sd(mean_cell_count, na.rm = TRUE),
    mean_cell_count = mean(mean_cell_count, na.rm = TRUE),
    n               = n(),
    .groups = "drop"
  )

summary_tissue
```
Setting color manually for each geneotype (genet) and renaming the individuals from mtt1 -> tunciate 1 
```{r}
genet_colors <- c(
  "mtt1" = "#1B9E77",
  "mtt2" = "#D95F02",
  "mtt3" = "#7570B3"
)

scale_color_manual(
  values = genet_colors,
  labels = c(
    "mtt1" = "Tunicate 1",
    "mtt2" = "Tunicate 2",
    "mtt3" = "Tunicate 3"
  ),
  drop = FALSE
)

```


```{r}
setwd('..')
png(filename = "output/cell_count.png", width = 1200, height = 900)
ggplot(genet_means,
       aes(x = tissue, y = mean_cell_count, fill = tissue)) +
  stat_summary(
    fun = mean,
    geom = "bar",
    width = 0.65,
    color = "black"
  ) +
  stat_summary(
    fun.data = mean_sdl,
    fun.args = list(mult = 1),   # ±1 SD across genets
    geom = "errorbar",
    width = 0.2
  ) +
  geom_jitter(
    aes(color = genet),
    width = 0.1,
    size = 3.5,
    alpha = 0.8
  ) +
  scale_fill_manual(
    values = c("zooid" = "grey",
               "bud"   = "white")
  ) +
   scale_color_manual(
    values = genet_colors,
    labels = c(
      "mtt1" = "Tunicate 1",
      "mtt2" = "Tunicate 2",
      "mtt3" = "Tunicate 3"
    ),
    drop = FALSE
  ) +
  labs(
    x = "Seeded tissue type",
    y = "Genet-level mean cell count",
    color = "Genet"
  ) +
  guides(
    fill = "none"   # ⬅️ removes tissue legend
  ) +
  theme_classic() +
  theme(
    text = element_text(family = "sans"),
    axis.title.x = element_text(size = 33),
    axis.title.y = element_text(size = 33),
    axis.text.x  = element_text(size = 30),
    axis.text.y  = element_text(size = 30),

    # ⬇️ legend sizing
    legend.title = element_text(size = 28),
    legend.text  = element_text(size = 24),
    legend.key.size = unit(1.5, "cm")
  )

dev.off()
```

Mock for nickel exposure 

```{r}
library(tidyverse)

# Mock fold-change dataset (no growth)
fold_cells <- tribble(
  ~Ni_mgL, ~replicate, ~fold_change,
  0,     1, 0.98,
  0,     2, 0.95,
  0,     3, 0.97,
  0.1,   1, 0.93,
  0.1,   2, 0.92,
  0.1,   3, 0.90,
  1,     1, 0.85,
  1,     2, 0.82,
  1,     3, 0.80,
  10,    1, 0.60,
  10,    2, 0.58,
  10,    3, 0.55,
  100,   1, 0.32,
  100,   2, 0.30,
  100,   3, 0.28,
  1000,  1, -0.12,
  1000,  2, -0.10,
  1000,  3, -0.08
)

# Order concentrations
fold_cells <- fold_cells %>%
  mutate(Ni_mgL = factor(Ni_mgL, levels = c(0, 0.1, 1, 10, 100, 1000)))
```

```{r}

setwd('..')
png(filename = "output/cell_count_mock_nickel.png", width = 1200, height = 900)
# Plot object
 ggplot(fold_cells, aes(x = Ni_mgL, y = fold_change, fill = Ni_mgL)) +
  stat_summary(fun = mean, geom = "bar", width = 0.7, color = "black") +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2) +
  geom_jitter(width = 0.1, size = 3, alpha = 0.7) +
  scale_fill_brewer(palette = "Blues") +
  labs(
    x = "Nominal nickel(II) chloride concentration (mg/L)",
    y = "Fold change in cell number\n(24 hpe / 0 hpe)"
  ) +
  theme_classic() +
  theme(
    axis.title.x = element_text(size = 22),
    axis.title.y = element_text(size = 22),
    axis.text.x  = element_text(size = 20, angle = 45, hjust = 1),
    axis.text.y  = element_text(size = 20),
    plot.title   = element_text(size = 26, face = "bold"),
    legend.position = "none"
  )

# Save PNG
ggsave("fold_change_by_nickel_mock_nogrowth.png", p_fold,
       width = 1200, height = 900, units = "px", dpi = 300)
dev.off()
```

